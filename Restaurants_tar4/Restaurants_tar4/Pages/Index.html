
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="../Scripts/ajaxCallsWithKey.js"></script>
    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <script src="../Scripts/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="StyleSheet.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>

        $(document).ready(function () {
        

            $(".cuisine_btn").click(function () {

                cusineId = this.id;
                let api = "https://developers.zomato.com/api/v2.1/search?entity_id=280&entity_type=city&cuisines=" + this.id;
                ajaxCall("GET", api, "", getSuccess, getError);
                
                
            });
            $(document).on("click", ".round-button", addF)
        });

        function addF() {
            if (confirm("Are you sure you want to add " + this.value + " to your favorites?")) {
                //console.log(this.id);
                $(this).prop('disabled', true)
                let api = "https://developers.zomato.com/api/v2.1/restaurant?res_id=" + this.id;
                ajaxCall("GET", api, "", getAddSuccess, getAddError);
            }


        }

        function getAddSuccess(rest) {
            console.log(rest);
            let id = parseInt(rest.id);
            let img = rest.featured_image;
            let name = rest.name;
            let rating = parseFloat(rest.user_rating.aggregate_rating);
            let category = rest.cuisines;
            let priceR = parseInt(rest.price_range);
            let phoneNum = rest.phone_numbers;
            let address = rest.location.address;
            let url = rest.url;
            let highlights = rest.highlights;
            //let cuisineId = rest.
            
            let res = {

                Image: img,
                Id: id,
                Name: name,
                Reating: rating,
                Category: category,
                PriceRange: priceR,
                Phone: phoneNum,
                Address: address,
                CuisineId: cusineId,
                Url: url,
                Highlights: highlights
            }

            console.log(res);
            
            ajaxCall("POST", "../api/businesses/favorites", JSON.stringify(res), postSuccess, postError);
            ajaxCall("POST", "../api/businesses/highlights", JSON.stringify(res), posthSuccess, posthError);
            
        }

        function posthSuccess(data) {
            console.log(data);
            swal("Your highlight Added Successfuly!", "Thank you :)", "success");

        }

        function posthError(err) {

            if (err.status == "500") {
                swal("error highlight Connection to server are failed :(", "Please Try Again", "");
            }
            else if (err.status == "409") {
                swal("The restaurants is already exists", "Please choose another one", "");
            }
        }

        function getAddError(rest) {
            console.log(rest);
        }

        function postSuccess(data) {
            console.log(data);
            swal("Your Favorite Restaurant Added Successfuly!", "Thank you :)", "success");
            
        }

        function postError(err) {

            if (err.status == "500") {
                swal("Connection to server are failed :(", "Please Try Again", "");
            }
            else if (err.status == "409") {          
                swal("The restaurants is already exists", "Please choose another one", "");
            }
        }


        function getSuccess(data) {

            
            console.log(data);
            
            render(data.restaurants);
        }
        function getError(err) {

            console.log(err);
        }
        function render(arr) {
            let str = `<div><table><tr>
                                                        <td><h3>Favorite</h3></td>
                                                        <td><h3>Image</h3></td>
                                                        <td><h3>ID</h3></td>
                                                        <td><h3>Name</h3></td>
                                                        <td><h3>Rating</h3></td>
                                                        <td><h3>Category</h3></td>
                                                        <td><h3>Price Range</h3></td>
                                                        <td><h3>Phone number</h3></td>
                                                        <td><h3>Address</h3></td>
                                                 </tr>`;
            for (var i = 0; i < arr.length; i++) {
              
                str += `<tr>
                                                                    <td><button class="round-button" id="` + arr[i].restaurant.id + `"value="` + arr[i].restaurant.name + `">Add</button></td>`
                if (arr[i].restaurant.featured_image == "") {
                    str += `<td> <img src="default.jpg" /></td>`
                }
                else {
                    str += `<td> <img src="` + arr[i].restaurant.featured_image + `"></td>`
                }
                                                                    
                                                          str +=   `<td>` + arr[i].restaurant.id + `</td>
                                                                    <td>` + arr[i].restaurant.name + `</td>
                                                                    <td>` + arr[i].restaurant.user_rating.aggregate_rating + `</td >
                                                                    <td>` + arr[i].restaurant.cuisines + `</td>
                                                                    <td>` + arr[i].restaurant.price_range + `</td>
                                                                    <td>` + arr[i].restaurant.phone_numbers + `</td >
                                                                    <td>` + arr[i].restaurant.location.address + `</td>
                                                                </tr>`
            }
            str += `</table></div>`;
            $("#ph1").html(str);
        }
    </script>

</head>
<body>
    <div id="ph">
        <a href="customerForm.html" class="myButtonadd">
            add customer
        </a>
        <a href="Favorites.html"><i class="material-icons" style="font-size:48px;color:black">star</i></a>
        <div>
            <br><h1>Choose cuisine in NYC</h1>
            <button id="1" class="myButton cuisine_btn">American</button>
            <button id="30" class="myButton cuisine_btn">Cafe</button>
            <button id="40" class="myButton cuisine_btn">Fast food</button>
            <button id="82" class="myButton cuisine_btn">Pizza</button>
            <button id="141" class="myButton cuisine_btn">Steak</button>
            <button id="177" class="myButton cuisine_btn">Sushi</button>
        </div>
        <br />
        <div id="ph1"></div>

    </div>

</body>
</html>